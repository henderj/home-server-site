{{define "main"}}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<h1>{{.SetName}}</h1>
<div role="group">
    {{range .Dice}}
        <button {{if .Selected}}aria-current="true"{{end}}>d{{.Sides}}</button>
    {{end}}
</div>
<div>
    <h2>{{.SetName}} (d{{.Die.Sides}})</h2>
    <form action="/dice/add-roll" method="POST">
        <textarea name="rolls" rows="4" cols="30" placeholder="Enter rolls, one per line"></textarea><br>
        <input type="hidden" name="die_id" value="{{.Die.ID}}">
        <button type="submit">Add Rolls</button>
    </form>
    <canvas id="rollChart" width="600" height="300"></canvas>
    <script type="application/json" id="chart-data">{{.JsonData}}</script>
</div>
<script>
    (function () {
        const ctx = document.getElementById('rollChart').getContext('2d');
        const data = JSON.parse(document.getElementById('chart-data').textContent);
        if (window.rollChartInstance) rollChartInstance.destroy();
        rollChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(d => d.value),
                datasets: [
                    {label: 'Actual', data: data.map(d => d.count), backgroundColor: 'rgba(75,192,192,0.5)'},
                    ...(data[0]?.ideal !== undefined ? [{
                        label: 'Ideal', data: data.map(d => d.ideal), backgroundColor: 'rgba(153,102,255,0.5)'
                    }] : [])
                ]
            },
            options: {scales: {y: {beginAtZero: true}}}
        });
    })();
</script>
{{end}}
